{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Launch Instance Infrastructure",
    "Parameters": {
        "destCidrValue": {
            "Type": "String",
            "Default": "0.0.0.0/0"
        },
        "vpcCidr": {
            "Type": "String"
        },
        "subnetCidr": {
            "Type": "CommaDelimitedList"
        },
        "vpcName": {
            "Type": "String"
        }
    },

    "Resources":{
        "VPC": {
            "Type" : "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock" : { "Ref": "vpcCidr"},
                "Tags": [ { "Key": "vpcName", "Value": { "Ref": "vpcName"} } ]
            }
        },

        "SubnetA": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": { "Ref": "VPC"},
                "CidrBlock": { "Fn::Select":[ 0, {"Ref": "subnetCidr"} ] },
                "AvailabilityZone": { "Fn::Select": [ 0, {"Fn::GetAZs": {"Ref": "AWS::Region"} } ] }
            }
        },
    
        "SubnetB": {
            "Type": "AWS::EC2::Subnet",
             "Properties": {
                "VpcId": { "Ref": "VPC"},
                "CidrBlock": { "Fn::Select":[ 1, {"Ref": "subnetCidr"} ] },
                "AvailabilityZone": { "Fn::Select": [ 1, {"Fn::GetAZs": {"Ref": "AWS::Region"} } ] }
                }
            },
    
        "SubnetC": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": { "Ref": "VPC"},
                "CidrBlock": { "Fn::Select":[ 2, {"Ref": "subnetCidr"} ] },
                "AvailabilityZone": { "Fn::Select": [ 2, {"Fn::GetAZs": {"Ref": "AWS::Region"} } ] }
            }
        },
    
        "InternetGateway": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {
                "Tags":[{"Key" : "IG", "Value": "internet Gateway test"}]
            }
        },
    
        "AttachInternetGateway": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "VpcId": { "Ref": "VPC" },
                "InternetGatewayId" : { "Ref": "InternetGateway" }
            }
        },
    
        "PublicRouteTable": {
            "Type":"AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": { "Ref": "VPC" }
            }
        },
    
        "SubnetARouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": { "Ref" : "SubnetA" },
                "RouteTableId": { "Ref" : "PublicRouteTable" }
            }
        },
    
        "SubnetBRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": { "Ref" : "SubnetB" },
                "RouteTableId": { "Ref" : "PublicRouteTable" }
            }
        },
    
        "SubnetCRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": { "Ref" : "SubnetC" },
                "RouteTableId": { "Ref" : "PublicRouteTable" }
            }
        },
    
        "PublicRoute": {
            "Type": "AWS::EC2::Route",
            "DependsOn": "AttachInternetGateway",
            "Properties": {
                "RouteTableId": { "Ref" : "PublicRouteTable" },
                "DestinationCidrBlock" : { "Ref": "destCidrValue" },
                "GatewayId": { "Ref": "InternetGateway" }
            }
        }

    },

    "Outputs": {

        "Region": {
            "Description": "Get region",
            "Value": {
                "Ref": "AWS::Region"
            }
        },


        "AZSubnetA": {
            "Description": "Get availability zone subnet A",
            "Value": {
                "Fn::GetAtt": [
                    "SubnetA",
                    "AvailabilityZone"
                ]
            }
        },

        "AZSubnetB": {
            "Description": "Get availability zone subnet B",
            "Value": {
                "Fn::GetAtt": [
                    "SubnetB",
                    "AvailabilityZone"
                ]
            }
        },

        "AZSubnetC": {
            "Description": "Get availability zone subnet C",
            "Value": {
                "Fn::GetAtt": [
                    "SubnetC",
                    "AvailabilityZone"
                ]
            }
        },

        "VPCId": {
            "Description": "Get Vpc Id",
            "Value": { "Ref": "VPC"}
        }
    }
}